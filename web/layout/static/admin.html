<script>
	function addNewUser() {
		$("#ic_bad_user_holder").css('display','none');
		$("#ic_bad_password_holder").css('display','none');
		$("#ic_short_password_holder").css('display','none');
		
		if($("#ic_username").val().length <= 3) {
			$("#ic_bad_user_holder").css('display','block');
			return;
		}
		
		if($("#ic_password").val() != $("#ic_password_check").val()) {
			$("#ic_bad_password_holder").css('display','block');
			return;
		}
		
		if($("#ic_password").val().length <= 5) {
			$("#ic_short_password_holder").css('display','block');
			return;
		}
		
		$.ajax({
			url : "/users/",
			dataType: "json",
			type: "POST",
			data: {
				username: $("#ic_username").val(),
				password: $("#ic_password").val()
			},
			success: function(json) {
				if(json.ok) {
					$("#new_user_name").html($("#ic_username").val());
					$("#ic_user_success_holder").css('display','block');
					$("#ic_username").val("");
					$("#ic_password").val("");
					$("#ic_password_check").val("");
					
					window.setTimeout(function() {
						$("#ic_user_success_holder").css('display','none');
					}, 3000);
				} else {
					$("#ic_bad_user_holder").css('display','block');
				}
			}
		});
	}
</script>
<h3><span class="translatable ic_user_alias">Admin</span> <a class="ic_exit" rel="aux_popup">[x]</a></h3>
<ul class="ic_panel_ul">
	<li>
		<a class="ic_button ic_panel_header" onclick="toggleElement('#add_new_user');">Add a new user</a>
		<div id="add_new_user" style="display:none;">
			<p>Usernames must be at least 4 alphanumeric characters and must not contain spaces.</p>
			<p>Passwords must be at least 6 characters.</p>
			<p>Username: <input id="ic_username" type="text" /></p>
			<p>Password: <input id="ic_password" type="password" /></p>
			<p>Confirm password: <input id="ic_password_check" type="password" /></p>
			<a class="ic_button ic_note_bene" onclick="addNewUser();">Submit</a>
		</div>
		<div id="ic_bad_user_holder" class="ic_error" style="display:none;">Sorry. This username is invalid.  Please try again.</div>
		<div id="ic_bad_password_holder" class="ic_error" style="display:none;">Sorry. Your passwords do not match.  Please try again.</div>
		<div id="ic_short_password_holder" class="ic_error" style="display:none;">Sorry. Your password is too short.  Please try again.</div>
		<div id="ic_user_success_holder" class="ic_note_bene" style="display:none;">Success!  Created user <span id="new_user_name"></span>.</div>
	</li>
</ul>